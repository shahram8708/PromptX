{% extends "base.html" %}

{% block title %}Error - PromptX{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
    <div class="col-lg-8">
        
        <div class="card border-0 shadow-lg">
            <div class="card-body text-center py-5">
                <div class="mb-4">
                    <i class="fas fa-exclamation-triangle fa-4x text-warning mb-3"></i>
                    <h2 class="text-danger mb-3">Oops! Something went wrong</h2>
                    <p class="lead text-muted mb-4">
                        We ran into a technical issue while processing your AI-generated video. Our system has logged it automatically.
                    </p>
                </div>

                {% if error_message %}
                <div class="alert alert-danger border-0 shadow-sm mb-4">
                    <h6 class="alert-heading">
                        <i class="fas fa-info-circle me-2"></i>
                        Error Details
                    </h6>
                    <p class="mb-0">{{ error_message }}</p>
                </div>
                {% endif %}

                
                <div class="row text-start mb-4">
                    <div class="col-md-6">
                        <div class="card bg-light border-0 h-100">
                            <div class="card-body">
                                <h6 class="card-title text-primary">
                                    <i class="fas fa-tools me-2"></i>
                                    Common Issues
                                </h6>
                                <ul class="small mb-0">
                                    <li>AI model failed to map visuals to narration context</li>
                                    <li>Prompt was too abstract or ambiguous</li>
                                    <li>Resource overload during video synthesis</li>
                                    <li>Voice and video synchronization conflict</li>
                                    <li>Unexpected input data structure</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-light border-0 h-100">
                            <div class="card-body">
                                <h6 class="card-title text-success">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    What You Can Do
                                </h6>
                                <ul class="small mb-0">
                                    <li>Try rephrasing your input with clearer context</li>
                                    <li>Avoid overly long or complex narrative structures</li>
                                    <li>Refresh the page and try again</li>
                                    <li>Use shorter prompts for faster synthesis</li>
                                    <li>Contact support if the issue continues</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                
                <div class="d-flex flex-column flex-md-row gap-3 justify-content-center">
                    <a href="{{ url_for('index') }}" class="btn btn-primary">
                        <i class="fas fa-arrow-left me-2"></i>
                        Try Again
                    </a>
                    <button class="btn btn-outline-secondary" onclick="refreshPage()">
                        <i class="fas fa-redo me-2"></i>
                        Refresh Page
                    </button>
                    <a href="mailto:support@promptx.ai" class="btn btn-outline-info">
                        <i class="fas fa-envelope me-2"></i>
                        Contact Support
                    </a>
                </div>

                {% if request.endpoint %}
                <div class="mt-4">
                    <small class="text-muted">
                        <i class="fas fa-code me-1"></i>
                        Error source: {{ request.endpoint }}
                        <span class="mx-2">|</span>
                        <i class="fas fa-clock me-1"></i>
                        <span id="errorTimestamp"></span>
                    </small>
                </div>
                {% endif %}
            </div>
        </div>

        
        <div class="card border-0 shadow-sm mt-4">
            <div class="card-header bg-primary text-white">
                <h6 class="mb-0">
                    <i class="fas fa-question-circle me-2"></i>
                    Frequently Asked Questions
                </h6>
            </div>
            <div class="card-body">
                <div class="accordion" id="errorFAQ">
                    <div class="accordion-item border-0">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#faq1">
                                Why did my video generation fail?
                            </button>
                        </h2>
                        <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#errorFAQ">
                            <div class="accordion-body">
                                Video generation may fail if the AI model couldn't interpret the context of your prompt accurately,
                                or if system resources were maxed during visual or audio synthesis. It may also happen with abstract inputs.
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item border-0">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#faq2">
                                How long should I wait before trying again?
                            </button>
                        </h2>
                        <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#errorFAQ">
                            <div class="accordion-body">
                                You can retry immediately, but for best results, we recommend giving it 1–2 minutes before
                                submitting again to allow the AI queue to reset.
                            </div>
                        </div>
                    </div>

                    <div class="accordion-item border-0">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#faq3">
                                What if the issue keeps happening?
                            </button>
                        </h2>
                        <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#errorFAQ">
                            <div class="accordion-body">
                                If you’re repeatedly seeing errors, please contact our team with your prompt, time of failure,
                                and any error message you received. We'll investigate quickly and provide a fix or workaround.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</div>
{% endblock %}

{% block extra_js %}
<script>
    
    const tsElement = document.getElementById('errorTimestamp');
    if (tsElement) {
        const now = new Date();
        const formatted = now.getFullYear() + '-' +
            String(now.getMonth() + 1).padStart(2, '0') + '-' +
            String(now.getDate()).padStart(2, '0') + ' ' +
            String(now.getHours()).padStart(2, '0') + ':' +
            String(now.getMinutes()).padStart(2, '0') + ':' +
            String(now.getSeconds()).padStart(2, '0');
        tsElement.textContent = formatted;
    }

    function refreshPage() {
        window.location.reload();
    }

    
    $(document).ready(function () {
        
        let countdown = 30;
        const autoRefreshBtn = $('<button class="btn btn-sm btn-outline-secondary mt-3">Auto refresh in <span id="countdown">30</span>s</button>');

        
        /*
        $('.card-body .d-flex').after(autoRefreshBtn);
        
        const interval = setInterval(() => {
            countdown--;
            $('#countdown').text(countdown);
            
            if (countdown <= 0) {
                clearInterval(interval);
                window.location.reload();
            }
        }, 1000);
        
        
        $(document).on('click keypress', function() {
            clearInterval(interval);
            autoRefreshBtn.remove();
        });
        */
    });

    
    window.moment = window.moment || function () {
        return {
            format: function (format) {
                const now = new Date();
                if (format === 'YYYY-MM-DD HH:mm:ss') {
                    return now.getFullYear() + '-' +
                        String(now.getMonth() + 1).padStart(2, '0') + '-' +
                        String(now.getDate()).padStart(2, '0') + ' ' +
                        String(now.getHours()).padStart(2, '0') + ':' +
                        String(now.getMinutes()).padStart(2, '0') + ':' +
                        String(now.getSeconds()).padStart(2, '0');
                }
                return now.toLocaleString();
            }
        };
    };
</script>
{% endblock %}